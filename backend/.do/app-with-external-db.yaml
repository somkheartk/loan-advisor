#
# DigitalOcean App Platform Deployment Template (External MongoDB)
# This configuration uses an external MongoDB (e.g., MongoDB Atlas Free Tier)
# Total cost: $5/month (just the app service)
#
spec:
  name: loan-advisor-backend
  region: sgp
  
  # Backend Service - Node.js API ($5/month Basic tier)
  services:
    - name: api
      # Build configuration
      source_dir: /backend
      build_command: npm ci && npm run build
      
      # Runtime configuration
      run_command: npm run start:prod
      
      # Environment configuration
      environment_slug: node-js
      
      # Instance configuration - Basic tier ($5/month)
      # Basic: 512MB RAM, 1 vCPU
      instance_count: 1
      instance_size_slug: basic-xxs
      
      # HTTP configuration
      http_port: 3000
      
      # Health check
      health_check:
        http_path: /health
        initial_delay_seconds: 10
        period_seconds: 10
        timeout_seconds: 5
        success_threshold: 1
        failure_threshold: 3
      
      # Environment variables
      envs:
        - key: NODE_ENV
          value: production
        - key: PORT
          value: "3000"
        - key: MONGODB_URI
          scope: RUN_TIME
          type: SECRET
        - key: JWT_SECRET
          scope: RUN_TIME
          type: SECRET
        - key: JWT_EXPIRES_IN
          value: "7d"
      
      # Routes
      routes:
        - path: /
