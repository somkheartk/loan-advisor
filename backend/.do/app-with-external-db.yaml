#
# DigitalOcean App Platform Configuration (External MongoDB)
# This configuration uses an external MongoDB (e.g., MongoDB Atlas Free Tier)
# Total cost: $5/month (just the app service)
#
spec:
  name: loan-advisor-backend
  region: sgp
  
  # Backend Service - Node.js API ($5/month Basic tier)
  services:
    - name: api
      # Deployment source
      github:
        repo: somkheartk/loan-advisor
        branch: main
        deploy_on_push: true
      
      # Build configuration
      source_dir: /backend
      build_command: npm ci && npm run build
      
      # Runtime configuration
      run_command: npm run start:prod
      
      # Environment configuration
      environment_slug: node-js
      
      # Instance configuration - Basic tier ($5/month)
      # Basic: 512MB RAM, 1 vCPU
      instance_count: 1
      instance_size_slug: basic-xxs
      
      # HTTP configuration
      http_port: 3000
      
      # Health check
      health_check:
        http_path: /health
        initial_delay_seconds: 10
        period_seconds: 10
        timeout_seconds: 5
        success_threshold: 1
        failure_threshold: 3
      
      # Environment variables
      envs:
        - key: NODE_ENV
          value: production
        - key: PORT
          value: "3000"
        - key: MONGODB_URI
          scope: RUN_TIME
          type: SECRET
          # Set this to your MongoDB Atlas or external MongoDB connection string
          # Example: mongodb+srv://username:password@cluster.mongodb.net/loan-advisor
        - key: JWT_SECRET
          scope: RUN_TIME
          type: SECRET
          # Generate a secure secret using: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
        - key: JWT_EXPIRES_IN
          value: "7d"
      
      # Routes
      routes:
        - path: /
